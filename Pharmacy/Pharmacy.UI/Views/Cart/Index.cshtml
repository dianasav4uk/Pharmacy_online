@using Pharmacy.Repos.Dto
@using Pharmacy.Repos
@using Microsoft.AspNetCore.Identity
@using Pharmacy.Core
@inject SignInManager<User> SignInManager
@inject UserManager<User> UserManager
@model CartView
@{
    @if (SignInManager.IsSignedIn(User))
    {
        //ClaimsPrincipal currentUser = this.User;
        //var currentUserID = UserRepos.GetUserByIdAsync(currentUser);
        var id = UserManager.GetUserId(User);
        //var user = UserManager.Users.First(x=>x.UserName == User.Identities.Name.ToString());
       // ViewData["user"] = currentUserID.Id.ToString();
    }
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h1>Кошик</h1>
<hr />


@if (Model.shopCartItems.Count > 0)
{
    <div class="row">
        <div class="col-9">
            <div class="row alert alert-secondary" role="alert">
                <div class="col">
                    <p>@Model.shopCartItems.Count товар(ів/и) в кошику</p>                    
                </div>
                <div class="col text-end">
                    <p ><a href="" class="font-weight-bold text-secondary">Продовжити покупки</a></p>
                    <p ><a href="" class="font-weight-bold text-secondary">Очистити все</a></p>
                </div>
            </div>
            <div class="row">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Товар</th>
                            <th>К-сть</th>
                            <th></th>
                            <th>Ціна</th>
                            <th>Проміжний підсумок</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var u in Model.shopCartItems)
                        {
                            <tr>
                                <td>
                                        <img src="/medicaments/getimage/@u.ProductId" class="card-img-top" style="width:5rem;" alt="...">

                                        <p class="font-weight-bold">@u.ProductName</p>

                                </td>
                                <td>@u.Quantity</td>
                                <td>
                                    <a class="btn btn-primary btn-sm" asp-action="Add" asp-route-id="@u.ProductId">+</a>
                                    <a class="btn btn-info btn-sm" asp-action="Decrease" asp-route-id="@u.ProductId">-</a>
                                    <a class="btn btn-danger btn-sm" asp-action="Remove" asp-route-id="@u.ProductId">Видалити</a>
                                </td>
                                <td>@u.Price.ToString("N2")</td>
                                <td>@Model.shopCartItems.Where(x=>x.ProductId==u.ProductId).Sum(x=>x.Quantity * x.Price).ToString("N2") грн</td>
                            </tr>
                        }
                    </tbody>
                    <tfoot>
                        <tr>
                        <td class="text-end" colspan="5">Підсумок:@Model.GrandTotal.ToString("N2") грн</td>
                        </tr>
                        <tr>
                            <td class="text-start" colspan="4">
                                <a class="btn btn-danger" asp-action="Clear" asp-controller="Cart">Clear Cart</a>
                                <a class="btn btn-primary" asp-action="CreateOrder" asp-controller="Cart">Замовити</a>
                            </td>
                        </tr>
                    </tfoot>
                </table>

            </div>
        </div>
        <div class="col-3"></div>

    </div>

}else
{
    <div class="row">
        <div>
            <div class="alert alert-secondary" role="alert">
                <p>Немає товарів</p>
            </div>
            <button asp-action="Index" asp-controller="Home" class="btn btn-primary">Продовжити покупки</button>
        </div>
    </div>
}